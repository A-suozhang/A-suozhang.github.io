I"<h1 id="dpué…ç½®">DPUé…ç½®</h1>
<ul>
  <li>æœ¬æ–‡ç« å†…å®¹æ˜¯ç”¨äºè®²è§£ä¸æ•´ç†<a href="https://a-suozhang.github.io/2019/09/06/ZCU102-Set-Up/">åœ¨ZCU102ä¸Šé…ç½®DPU</a>çš„ä¸€éƒ¨åˆ†å†…å®¹çš„åŸç†</li>
  <li>èƒŒæ™¯çŸ¥è¯†:
    <ul>
      <li>ç†Ÿæ‚‰åˆ©ç”¨Petalinuxç¼–è¯‘ç”ŸæˆZCU102çš„BOOTæµç¨‹</li>
      <li>ç†Ÿæ‚‰Xilinx Vivado SDK PSçš„ä½¿ç”¨</li>
      <li>ç†Ÿæ‚‰ä¸€äº›åŸºæœ¬çš„åµŒå…¥å¼æœºç†</li>
    </ul>
  </li>
</ul>

<h2 id="dpuè®¾å¤‡æ ‘é…ç½®">DPUè®¾å¤‡æ ‘é…ç½®</h2>
<ol>
  <li>åœ¨å®Œæˆpetalinuxçš„â€“get-hw=descriptionçš„conigä¹‹å
    <ul>
      <li>åœ¨petalinuxé¡¹ç›®ç›®å½•ä¸‹çš„ ./metauser/recipes-bsp/device-treeç›®å½•ä¸‹æœ‰ device-tree.bbapendæ–‡ä»¶(æè¿°äº†ç¼–è¯‘è®¾å¤‡æ ‘æ‰€æœ‰ç´¢å¼•),å°†å…¶å†…å®¹æ”¹ä¸º</li>
    </ul>
  </li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FILESEXTRAPATHS_prepend := "${THISDIR}/files:"

SRC_URI += "file://system-user.dtsi \
	    file://dpu.dtsi"                        // è¿™ä¸€è¡Œæ˜¯åæ¥åŠ å…¥çš„,è¡¨ç¤ºè¦ç´¢å¼•å½“å‰ç›®å½•ä¸‹./filesä¸­çš„dpu.dtsi

</code></pre></div></div>

<blockquote>
  <p>è¿™æ ·çš„æ–¹å¼æœ¬è´¨ä¸Šæ˜¯åœ¨system-user.dtsiçš„å¯¹åº”èŠ‚ç‚¹ä¸‹åŠ ä¸Šäº†dpuçš„å†…å®¹,è¿™æ ·æ›´åŠ æ¸…æ™°</p>
</blockquote>

<ol>
  <li>dpu.dtsiçš„ä½ç½®åœ¨åˆšæ‰ç›®å½•ä¸‹çš„./files/dpu.dtsiä¸­,å†…å®¹ä¸º</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ {
        amba{
		dpu{
		    #address-cells = &lt;1&gt;;
    		    #size-cells = &lt;1&gt;;
    		    compatible = "xilinx,dpu";
    		    base-addr = &lt;0x8F000000&gt;;     //CHANGE THIS ACCORDING TO YOUR DESIGN

		    dpucore {
		        compatible = "xilinx,dpucore";
		        interrupt-parent = &lt;&amp;gic&gt;;
		        interrupts = &lt;0x0 106 0x1 0x0 107 0x1&gt;;
		        core-num = &lt;0x2&gt;;
		    };

		    softmax {
		        compatible = "xilinx,smfc";
		        interrupt-parent = &lt;&amp;gic&gt;;
		        interrupts = &lt;0x0 110 0x1&gt;;
		        core-num = &lt;0x1&gt;;
		    };
		};
	};
};
</code></pre></div></div>

<ul>
  <li>è®¾å¤‡æ ‘çš„å†…å®¹ä¸æˆ‘ä»¬çš„Vivado Designæœ‰ç€ç›´æ¥å…³ç³»(æœ¬è´¨ä¸Šå°±æ˜¯é‚£ä¸ªä¸­æ–­å·)</li>
  <li>æŸ¥è¯¢<a href="">dpuæ•°æ®æ‰‹å†Œ</a>å¯çŸ¥,ä¸»è¦éœ€è¦ä¿®æ”¹çš„æ˜¯åœ°å€å’Œè®¾å¤‡å·ç 
    <ul>
      <li>
        <p>å…¶ä¸­ base-addréœ€è¦ä¸Vivado Designä¸­çš„Addresså¯¹åº”,ä¹Ÿå°±æ˜¯è¿™é‡Œ</p>
      </li>
      <li>
        <p><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907113921.png" alt="" /></p>
      </li>
      <li>dpucoreçš„æ•°ç›®ä¸å¹³å°æœ‰å…³ (ZCU102æ˜¯ä¸¤ä¸ª)</li>
      <li>interruptsä¸­çš„6ä¸ªæ•°,æ¯3ä¸ªä¸ºä¸€ç»„,ä¸¤è¾¹çš„0x0å’Œ0x1æ˜¯å›ºå®šå€¼,å†…éƒ¨çš„106ä¸107åˆ™æ˜¯dpuæ‰€å¯¹åº”çš„ä¸­æ–­å·
        <ul>
          <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master//img/20190907114224.png" alt="" /></li>
          <li>å¦‚å›¾å¯è§,dpuä»¥åŠå…¶é™„å±æ¨¡å—ç»™å‡ºäº†ä¸€ä¸ªä½å®½ä¸º7çš„ä¸­æ–­ä¿¡å·æ¥åˆ°äº†PSä¸Š</li>
          <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907114517.png" alt="" /></li>
          <li>è¿™é‡Œæ˜¯é‚£ä¸ª7ä½ä¸­æ–­ä¿¡å·çš„å†…éƒ¨ç»“æ„,å¯ä»¥çœ‹åˆ°,ä¸¤ä¸ªdpuæ ¸çš„ä¸­æ–­æ¥åˆ°äº†7ä½ä¿¡å·çš„[3:2]ä½,è€Œsoftmaxçš„ä¸­æ–­è¢«æ¥åˆ°äº†æœ€é«˜ä½</li>
          <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907115019.png" alt="" /></li>
          <li>åœ¨è¿™é‡Œé…ç½®ZynqPSçš„ä¸¤ä¸ª7ä½ä¸­æ–­,å‚è€ƒ<a href="https://www.xilinx.com/support/documentation/user_guides/ug1085-zynq-ultrascale-trm.pdf">ZU9-PS-INTRæ•°æ®æ‰‹å†Œ</a>æŸ¥è¯¢
            <ul>
              <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907120833.png" alt="" />
                <ul>
                  <li>æ„Ÿè§‰å’Œæˆ‘ä»¬å®é™…æ“ä½œçš„ç»“æœçŸ›ç›¾äº†â€¦å¾…è§£å†³â€¦</li>
                </ul>
              </li>
            </ul>
          </li>
          <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907121356.png" alt="" />
            <ul>
              <li>å¥½åƒè¯´å¦‚æœè¦æ­£å¸¸ç”¨DNNDKçš„è¯åªèƒ½è¿™ä¹ˆé…ç½®
                <blockquote>
                  <p>æ›¾ç»å°è¯•è¿‡ç›´æ¥æ”¹åŠ¨system-user.dtsiï¼Œä½†æ˜¯è²Œä¼¼ä¸èµ·ä½œç”¨
ã€€è®¾å¤‡æ ‘çš„æ”¹å˜å…¶å®åœ¨petalinux-buildçš„ä¸€æ­¥ï¼Œå¦‚æœæ²¡æœ‰çš„è¯æ”¹åŠ¨å®ƒæ²¡æœ‰æ„ä¹‰</p>
                </blockquote>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="dpué©±åŠ¨">DPUé©±åŠ¨</h2>
<ul>
  <li>å‚è€ƒPetalinuxæ–‡æ¡£<a href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2018_3/ug1144-petalinux-tools-reference-guide.pdf">UG1144</a>ä¸­çš„Building UserModuleä¸€ç« èŠ‚
    <ul>
      <li><img src="https://github.com/A-suozhang/MyPicBed/raw/master/img/20190907125426.png" alt="" /></li>
      <li>æŒ‰ç…§è¿™é‡Œçš„æ­¥éª¤èµ°å®Œå°±å¯ä»¥äº†</li>
    </ul>
  </li>
  <li>ä¹‹åæŠŠç”Ÿæˆçš„dpu.koæ‹·è´åˆ°æˆ‘ä»¬è‡ªå·±çš„rootfsä¸­,å¹¶ä¸”éœ€è¦è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
    <ul>
      <li>åœ¨/etc/rc.localä¸­åŠ å…¥
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>insmod dpu.ko
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>
:ET