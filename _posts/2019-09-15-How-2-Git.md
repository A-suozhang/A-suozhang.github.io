---
layout:     post                    # 使用的布局（不需要改）
title:      如何使用Git            # 标题 
subtitle:   VScode的git插件在非正常使用下陷入混乱        #副标题
date:       2019-12-2              # 时间
author:     tianchen                      # 作者
header-img:  img/bg-cat1.jpg  #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
     - Coding
---

# 如何正常使用git

> 小金鱼A_suozhang需要一些记录来保证自己不会忘记这些命令

## WorkFlow

### Simplest Example

* 首先 ```git init``` 创建仓库
* 工作流（3棵树）
  * ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20191202180520.png)
  * 中间的是index(暂存区），是一个缓存区域
  * 最后的是Head（也就是指向最后一次提交(Commit)的结果），*到了head还不代表到了remote repository远程仓库*
* ```git add .```将当前目录的改动暂存(Stage)
* ```git commit -m "XXX"```将Index中的内容提交给head
* ```git push ```推送改动
  
### 分支 (Branch)

> 其产生是为了特性开发绝缘，创建仓库的时候，默认分支为“Master”

* 创建新的分支 ```git checkout -b feature_x ```
  * 删除新的分支(当然你首先要切回主分支) ```git branch -d feature_x```
  * 推送到当前分支 ```git push origin feature_x```
* 切换回到主分支 ```git checkout master```

### 更新与合并 

* 更新本地仓库(Local Repo)到最新的改动 ```git pull``` 
  * 相当于在目前的目录中获取(Fetch)并且合并(Merge)了远端(Remote)的改动
* 如果你只想合并其他某个分支到你的当前分支 ```git merge branch```
* *执行以上两者的时候都自动合并冲突(Conflict)，有时候可能不成功，就要手动合并，修改完之后利用```git add <Filename>```来表征合并完毕，在合并的时候利用```git diff <Source_Branch> <Target Branch>```*
* 替换本地文件，采用```git checkout <filename>```用head中的文件替换本地的文件（但是不会改变stage）
  * 将Head复制到了Local Repo
* ```git reset -- files ```撤销最后一次git add
  * 也就是撤销stage区域
* 替换整个本地仓库为云端版本，先获取服务器的最新版本```git fetch origin```，将本地仓库指向它 ```git reset --hard origin/master```

## 补充（Complement）

---

#### 关于Add

![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20190915105530.png)
* 在git add环节同样也可以git rm (都会对VScode当中的git插件里面状态栏起效果,在staged change当中)
  * ```git add .```把本地的所有文件add进去
  * 本地文件如果只是修改了,没有执行git add,在VScode插件里面只显示CHANGES,如果进行了add之后,则显示STAGED CHANGES
* 在Vscode当中的Commit按钮相当于执行了```git add.```,并且执行了```git commit```
* 在Commit之前,可以用```git status```来查看当前的修改情况

``` bash
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        deleted:    README.md
        modified:   _posts/2019-09-15-How-2-GItignore.md
```

* 如果本地有没有add的东西,会显示

``` bash
On branch master
Your branch is up to date with 'origin/master'.

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        deleted:    README.md
        modified:   _posts/2019-09-15-How-2-GItignore.md

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   _posts/2019-09-15-How-2-GItignore.md

```

* 一些简单的模板
```
#注释           .gitignore的注释
*.txt           忽略所有 .txt 后缀的文件
!src.a          忽略除 src.a 外的其他文件
/todo           仅忽略项目根目录下的 todo 文件，不包括 src/todo
build/          忽略 build/目录下的所有文件，过滤整个build文件夹；
doc/*.txt       忽略doc目录下所有 .txt 后缀的文件，但不包括doc子目录的 .txt 的文件

bin/:           忽略当前路径下的 bin 文件夹，该文件夹下的所有内容都会被忽略，不忽略 bin 文件
/bin:           忽略根目录下的 bin 文件
/*.c:           忽略 cat.c，不忽略 build/cat.c
debug/*.obj:    忽略debug/io.obj，不忽略 debug/common/io.obj和tools/debug/io.obj
**/foo:         忽略/foo, a/foo, a/b/foo等
a/**/b:         忽略a/b, a/x/b, a/x/y/b等
!/bin/run.sh    不忽略bin目录下的run.sh文件
*.log:          忽略所有 .log 文件
config.js:      忽略当前路径的 config.js 文件

/mtk/           忽略整个文件夹
*.zip           忽略所有.zip文件
/mtk/do.c       忽略某个具体文件
```



#### 对某个repo免密码push

* 打开该工程目录下的.git/config
  * 将url改成```https://A-suozhang:$PASSWD@github.com/A-suozhang/$REPO_NAME```

#### 暴力PUSH
* 因为各种操作（比如回退到了之前的Commit）可能会出现```Your Repo Is Behind master/branch by 2 commit, try git pull first```现在理论上是不能commit也不能push的，但是如果我们真的需要push
* ```git push --force``` (谨慎啊)

#### 强行回退版本
1. 首先 ```git log```查看历史Commit,找到自己想要回到的那一次,记录下来COMMIT_ID
2. 执行 ```git reset --hard COMMIT_ID```
  * 相当于直接删除对应的commit
3. 或者是 ```git revert COMMIT_ID```
  * 相当于用一次新的commit来回滚到之前的commit

#### 测试更新与Branch

* 首先我新建一个文件```testGit.sh```
  * ```git add . ```过去，查看```git status```显示新增了一个文件
  * ```git reset --file testGit.sh```之后```git status```发现显示目前还有testGit.sh这个文件没有提交
* Addh回来，Commit上去```git commit -m "Adding testGit.sh"```,同步到了HEAD
* 新建一个branch ```git checkout -b branch0```
* 把HEAD push到新的branch上 ```git push origin branch0```
* 切换回到master branch， ```git checkout master```
* 直接 ```git pull```，完成之后发现新的文件testGit没有了(合理，因为master branch上并没有这个文件)
* 切换到```git checkout branch0```，然后```git pull```但是失败了，尝试```git pull origin branch0```，文件又回来了
* 执行```git diff master origin```对比几个branch
  * ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20191202192429.png)
* ```git branch -vv```查看对每个branch做了什么
  * ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20191202192500.png)
* ```git branch```查看当前的分支(带星号的是)
* ```git checkout master; git merge branch0``` 合并分支
* ```git branch -d branch0```删除合并后的分支



## Gitignore
### Tempelate
* 可以使用[Git官方提供的一些模板](https://github.com/github/gitignore),可以排除掉Build所产生的文件

### Place
* 就放在.git文件所在的目录

### Usage
* 保存.gitginore之后可以使用```git status```来检查是否正确(Vscode直接用git框子里面看)
* 也可以用```git check-ignore -v XXX```
* 主要用到的 (支持逻辑通配)
  *   *.pth
  *   folder1/folder2   
*  已经上传的,后修改了gitignore (清空缓存可以解决)
```
git rm -r --cached .
add .
```

## Refs
* [常见Trouble Shooting](https://blog.csdn.net/qq_15437629/article/details/78761459)
* [教你系统学习Git](https://www.jianshu.com/p/fe038a97bb3c)
* [git-guide](http://rogerdudler.github.io/git-guide/index.zh.html)
* [一个git知乎的教学](https://zhuanlan.zhihu.com/p/96631135) 
