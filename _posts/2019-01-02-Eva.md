---
layout:     post                    # ä½¿ç”¨çš„å¸ƒå±€ï¼ˆä¸éœ€è¦æ”¹ï¼‰
title:      Eva0å¼€å‘ç¬”è®°          # æ ‡é¢˜ 
subtitle:   ï¼ˆå¾…å¡«ä¸€ä¸ªevaæ¢—ï¼‰   #å‰¯æ ‡é¢˜
date:       2020-01-04          # æ—¶é—´
author:     tianchen                      # ä½œè€…
header-img:  img/10_1/bg-eva.jpg  #è¿™ç¯‡æ–‡ç« æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡  
catalog: true                       # æ˜¯å¦å½’æ¡£
tags:                               #æ ‡ç­¾
     - private
---

# EVA å¼€å‘æ—¥è®°

# ç½‘ç®¡ç›¸å…³

### LDAP related

1. ç™»å½•LDAPç³»ç»Ÿ
   * é€šè¿‡22222portç™»å½•ä¸Š205ï¼Œç„¶åŽå°†remoteçš„80ç«¯å£æ˜ å°„åˆ°æœ¬åœ°12888ç«¯å£
     * ï¼ˆç”±äºŽé»˜è®¤æ‰“å¼€æ–¹å¼ä¼šæ˜¾ç¤ºå®žéªŒå®¤ç½‘é¡µï¼Œéœ€è¦ç”¨modeHelperæ’ä»¶è¾“å…¥ä¸€ä¸ªruleï¼›Hostï¼› ldap.nics.cc; å¼€å¯ä¹‹åŽå°±å¯ä»¥è¿›å…¥ï¼‰
     * ![](https://github.com/A-suozhang/MyPicBed/raw/master//img/20210404142533.png)
2. æ‰‹åŠ¨æ·»åŠ ç”¨æˆ·
   * åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ç”¨æœç´¢â€œSearchâ€
   * é…ç½®æ˜¾ç¤ºuidNumber
     * ![](https://github.com/A-suozhang/MyPicBed/raw/master//img/20210404142716.png)
   * æ‰¾åˆ°æœ€åŽä¸€ä¸ªç”¨æˆ·(uidæœ€å¤§çš„)ï¼Œæ³¨æ„ä¸ªæ•°è°ƒå¤§ä¸€ç‚¹
     * ç„¶åŽcopy from existing profile

![](https://github.com/A-suozhang/MyPicBed/raw/master//img/20210404143227.png)

3. æˆ–è€…æ˜¯è®©å®ƒä»¬è‡ªå·±æ³¨å†Œç”¨æˆ·
   * åœ¨å®žéªŒå®¤å®˜ç½‘è¿›Internalè¿›è¡Œæ³¨å†Œï¼Œå®Œæˆä¹‹åŽåº”è¯¥å°±æœ‰å®žéªŒå®¤è´¦å·äº†
   * éªŒè¯é—®é¢˜: æ±ªæ­¦å¤©å¼ˆ

## æœåŠ¡å™¨è°ƒè¯•å¸¸ç”¨æ“ä½œ

1. æŸ¥çœ‹ç£ç›˜IO
   * çŽ°è±¡: vimä¿å­˜æ–‡ä»¶å¡é¡¿ï¼Œä½†æ˜¯tmuxåˆ‡æ¢çª—å£ä¸å¡é¡¿
   * ä½¿ç”¨`iotop`å‘½ä»¤ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹ï¼Œåœ¨containerå†…éƒ¨æ˜¯ä¼šæŠ¥OSErrorï¼Œéœ€è¦ä¸»æœºä¸Šçš„sudoæƒé™
2. æŸ¥çœ‹æœåŠ¡å™¨å ç”¨å†…å­˜/CPUæœ€å¤šçš„ç¨‹åº
   * `ps auxw|head -1;ps auxw|sort -rn -k4|head -10 ` å†…å­˜ï¼ˆæ”¹æˆk3å°±æ˜¯CPUï¼Œæ”¹æˆk5å°±æ˜¯è™šæ‹Ÿå†…å­˜ï¼‰
3. æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„è¿›ç¨‹`top -u zhaotianchen`
4. å‘çŽ°è°åœ¨ç”¨å¡åŽ»æŸ¥ä¸€ä¸‹ldapçœ‹ä¸€ä¸‹ä¸ªäººä¿¡æ¯

## LXCçŸ¥è¯†ç›¸å…³

* LXCèƒ½é€šè¿‡æ”¹å˜/var/lib/ä¸­çš„cfgä»¥åŠå…¶ä»–å†…å®¹åŠ¨æ€ç®¡ç†å„ä¸ªcontainer
* å¸¸ç”¨å‘½ä»¤
  * `lxc-ls -f` æŸ¥çœ‹å„ä¸ªcontainerçš„ä¿¡æ¯
  * `lxc-start -n XXX` å¯åŠ¨container
  * `lxc-attach -n xxx` ä»Žä¸»æœºè¿›å…¥æŸä¸ªcontainer
  * `lxc-top`
  * `lxc-monitor`

### Containerç»´æŠ¤ç›¸å…³

[ LXC Linuxç³»ç»Ÿå®¹å™¨ - æŸç§‘å­¦çš„æœ€åŽä¹‹ä½œ (yunfwe.cn)](https://yunfwe.cn/2019/09/23/2019/LXC Linuxç³»ç»Ÿå®¹å™¨/)

1. å¦‚ä½•å¼€ä¸€ä¸ªæ–°çš„Container
   * ç™»å½•ä¸»æœºï¼Œè¿›å…¥root
   * /home/work/lxc ä¸­æœ‰ä¸€ä¸ªfork_lxc_new.pyæ–‡ä»¶ï¼Œæœ‰ä»¥ä¸‹çš„è¾“å…¥argséœ€è¦å¡«å†™
     * -nï¼š containerçš„åå­—
     * -uï¼š userï¼Œéœ€è¦å’Œ/etc/login.user.allowå¯¹åº”ï¼Œå¯ä»¥ç”¨é€—å·éš”å¼€
     * --rootfs-size: ä¸€ä¸ªintè¡¨ç¤ºGB
     * --rootfs-prefix: è¡¨ç¤ºæŒ‚è½½åœ¨å“ªå—ç¡¬ç›˜ä¸Šï¼Œè¾“å…¥æ¯”å¦‚`/mnt/sdd` (äº‹å…ˆdf -khæŸ¥ä¸‹å“ªä¸ªç›˜æœ‰ç©ºé—´)
     * --bionicï¼š è¡¨ç¤ºæ˜¯å¦æ˜¯18.04
   * å‘ä¸ªé‚®ä»¶å‘Šè¯‰åˆ«äºº
   * æŒ‰ç…§å½“å‰å‘½ä»¤æ‰§è¡Œå°±å¯ä»¥ä»Žä¸€äº›å¯¹åº”ä½ç½®è¯»å–ä¸€äº›é»˜è®¤cfgå¹¶ä¸”æ‰§è¡Œå°†ç©ºç™½æ–‡ä»¶ç³»ç»Ÿå¤åˆ¶åˆ°å¯¹åº”çš„ä½ç½®
     * /home/work/lxc/templates_lxc
       * config: lxcçš„cfg
       * login.user.allowï¼ˆé»˜è®¤æœ‰ç½‘ç®¡çš„ï¼‰
     * /var/lib/lxc/ubuntu-cuda-base/rootfs.new(é»˜è®¤çš„ç©ºç™½æ–‡ä»¶ç³»ç»Ÿ)

* ç›®å‰å·²ç»èƒ½å¤Ÿç™»å½•å„ä¸ªä¸»æœº eva*.nics.cc
  * åœ¨æœ¬åœ°configé‡Œæ˜¯ç”¨ssh eva8 è¿™ç§å‘½ä»¤æ¥ç›´æŽ¥ç™»å½•
* srvAdminç»„:
  * ä»£è¡¨äº†å¯¹ä¸»æœºå’Œcontainerçš„sudoæƒé™
  * è™½ç„¶æœ‰containerçš„sudoæƒé™ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦containerçš„è¿›å…¥æƒé™ï¼›å¯ä»¥ç›´æŽ¥è¿›å…¥ä¸»æœºattachè¿›åŽ»ç„¶åŽç»™`/etc/login.user.allow`
* [å‡¯å“¥çš„ç½‘ç®¡éƒ¨æŠ€æœ¯æ•´ç†](https://www.yuque.com/doctor-kaizhong/lab-network)

2. æ”¹Rootfsçš„å¤§å°

* å…ˆstopåˆ°å½“å‰çš„container
* å‚è€ƒfork_lxc_newä¸­è„šæœ¬ä¸­çš„å‡ è¡Œä»£ç 
  * ![](https://github.com/A-suozhang/MyPicBed/raw/master//img/20210730103216.png)
* å…¶ä¸­çš„rootfs pathä»Ž`/var/lib/lxc/$NAME`ä¸­æ‰¾rootfsæ‰€linkåˆ°çš„ä½ç½®ï¼Œæ˜¯`/data2/lxc/ztc`å¯¹åº”ä½ç½®çš„ç¡®å®žæ˜¯å¤§æ–‡ä»¶
  * ![](https://github.com/A-suozhang/MyPicBed/raw/master//img/20210730103356.png)
* æ”¾äº†ä¸€ä¸ªè„šæœ¬åœ¨`/home/woirk/lxc/resizefs.sh`

3. æœåŠ¡å™¨è‡ªåŠ¨å…¥ç½‘:

* å…¥ç½‘çš„è„šæœ¬auth-linuxæˆ‘æ”¾åœ¨205çš„`/home/eva_share`ä¸‹äº†ï¼Œä¹‹åŽå¯ä»¥ä»Žè¿™é‡Œscp

* åœ¨æˆ‘çš„æœåŠ¡å™¨çš„homeç›®å½•ä¸‹å†™äº†ä¸€ä¸ªconfigï¼Œç„¶åŽåªè¦ç›´æŽ¥æ‰§è¡Œ./authå°±å¯ä»¥äº†ï¼Œéœ€è¦å†™ä¸€ä¸ªcrontab
  * [19. crontab å®šæ—¶ä»»åŠ¡ â€” Linux Tools Quick Tutorial (linuxtools-rst.readthedocs.io)](https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html)
  * still not safe enough, since should save passwd

* å†™ä¸€ä¸ªcrontabè„šæœ¬ `ping info.tsinghua.edu.cn` è®©å®ƒä¸€ç›´åœ¨å†…ç½‘ä¸­, and use the ztc.eva7.nics.cc to login

* åˆ›å»ºä¸€ä¸ªè„šæœ¬ä¹‹åŽï¼Œ`crontab $FILENAME`,ä¹‹åŽ`contab -l`æŸ¥çœ‹ä»€ä¹ˆæ­£åœ¨æ‰§è¡Œ
  * `crontab -e `ç›´æŽ¥ç¼–è¾‘
  * `crontab -r` åˆ é™¤

4. eva7ä¸Šçš„ç‰¹æ®Šè·¯ç”±æ–¹å¼

* åœ¨ä¸»æœºä¸Šç”¨`iptables -t nat -L` çœ‹äº†è¿™ä¸¤æ¡ruleï¼Œå…¶ä¸­å°†32223ç«¯å£ç»‘å®š(ç›®å‰è¿˜æ˜¯æŠŠè¿™ç§æ–¹å¼æ”¹æŽ‰äº†â€¦é‡å¯ä¹‹åŽå°±æ²¡äº†ï¼Œç•™æ¡£)

* ![image-20210510173319946](C:\Users\A-suozhang\AppData\Roaming\Typora\typora-user-images\image-20210510173319946.png)

### å¸¸è§é—®é¢˜

1. deviceQueryåœ¨sudoä¸‹ä»ç„¶å¤±æ•ˆï¼š(Error 35)
   * æ‰§è¡Œä¸€ä¸‹`ldconfig`
2. Containeré‡ŒæŠ¥é”™æ²¡æœ‰`nvidia-smi`å‘½ä»¤
   * å°†`/usr/local/nvidia/bin`åŠ å…¥çŽ¯å¢ƒå˜é‡
3. deviceQueryå¤±è´¥ï¼Œæˆ–å¾ˆæ…¢
   * sudoè¿è¡Œ`/usr/local/nvidia/bin/nvidia-persistenced`
4. é‡å¯containerä¹‹åŽcontainerä¸­deviceQueryæŠ¥é”™ï¼ŒæŠ¥é”™Error 30ï¼›
   * å¯èƒ½æ˜¯éœ€è¦åœ¨ä¸»æœºä¸Šæ‰§è¡ŒdeviceQueryå‘½ä»¤ï¼Œä¸»æœºçš„cudaå®‰è£…åœ¨`/home/opt/cuda-xx`
5. ï¼ˆä¸€èˆ¬ä¸ä¼šå‡ºçŽ°ï¼‰ä»Žä¸»æœºattachåˆ°containerä¸­å†suåˆ°ç”¨æˆ·ï¼Œå‘çŽ°ä¸èƒ½sudo suäº†ï¼Œç”¨`script /dev/null`

## SSHé…ç½®

* çŽ°åœ¨çš„æ–°çš„Configæ–‡ä»¶çš„å†…å®¹

```
Host eva
	HostName 101.6.64.169
	Port 22
	User zhaotianchen
	ProxyCommand ssh zhaotianchen@101.6.64.67 -p 42222 -W %h:%p
Host fpga
	HostName 101.6.68.236
	Port 22
	User ztc
	ProxyCommand ssh zhaotianchen@101.6.64.67 -p 42222 -W %h:%p

Host 205
  ForwardAgent yes
  HostName 101.6.64.67
  User zhaotianchen
  Port 42222

Host eva*
  HostName %h.nics.cc
  User zhaotianchen
  ProxyCommand ssh zhaotianchen@205 nc %h %p

Host proxy-eva10
  HostName eva10.nics.cc
  Port 32222
  User zhaotianchen
  ProxyCommand ssh zhaotianchen@205 nc %h %p

Host ztc.eva10
  HostName foxfi-eva10
  User zhaotianchen
  ProxyCommand ssh -p 32222 zhaotianchen@eva10 nc %h %p

Host *.eva*
  HostName %h.nics.cc
  User zhaotianchen
  ForwardAgent yes
  ProxyCommand ssh zhaotianchen@205 nc %h %p

```

* ä¸€äº›è§£é‡Šæ€§çš„æ–‡å­—
  * ncè¡¨ç¤ºä¸è¦å†Proxyåœä¸‹æ¥
  * %h è¡¨ç¤ºäº†HostName
  * %p è¡¨ç¤ºäº†Port
* ç»è¿‡è¿™æ ·çš„ä¸€å¥—é…ç½®åº”è¯¥æ˜¯å¯ä»¥ç”¨```ssh ztc.eva10```è¿™æ ·çš„å‘½ä»¤ç›´æŽ¥è·³è¿‡ä¸¤æ¬¡è·³æ¿æœºè·³ä¸ŠåŽ»äº†
  * å¯¹äºŽä¸€äº›é¢å¤–çš„é…ç½®æ¯”å¦‚è¯´ç«¯å£æ˜ å°„ï¼Œå¯ä»¥ç›´æŽ¥åŠ è½½æœ€åŽçš„è¿™ä¸ªæŒ‡ä»¤ä¸­æ¯”å¦‚ ```ssh -L 10808:localhost:127.0.0.1 ztc.eva10``` 
* å…³äºŽä¸Šä¼ ç§é’¥ä»¥å…å¯†ç ç™»å½•
  * é¦–å…ˆå†æœ¬åœ°è¿›è¡Œssh-keygenï¼Œä¼šæœ‰ä¸€ä¸ªid_rsaï¼ˆç§é’¥ï¼‰ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªid_rsa.pubå…¬é’¥ï¼ˆè¿™ä¸ªæ¯”ç¬¬ä¸€ä¸ªçŸ­ä¸€äº›ï¼‰
  * å…¶å®žåªæ˜¯éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå°†æœ¬åœ°çš„id_rsa.pubçš„å†…å®¹æ·»åŠ åˆ°./ssh/authorized_keyså½“ä¸­å³å¯ 
    * ç”¨```echo XXX >> authorized_keys``` è¿™ç§å½¢å¼
* If after loading keys, logging still requires passwd for eva-8/9
  * Try ```ssh-copy-key -i id_rsa.pub proxy-evaX```
* å¯ä»¥é€šè¿‡æ·»åŠ  - å°†æœåŠ¡å™¨ç«¯å£æ˜ å°„åˆ°æœ¬åœ° 
  * ``LocalForward 127.0.0.1:$PORT_ON_SERVER 127.0.0.1:$LOCAL_PORT```
  * ç­‰æ•ˆäºŽ```ssh -L 16379:127.0.0.1:6379 user@host```
  * åå‘çš„è¯å¯ä»¥ç”¨RemoteHost
* sshçš„configç›¸å…³çš„é…ç½®ç”¨```man ssh_config```å¯ä»¥æŸ¥è¯¢
  * -L è¡¨ç¤ºLocalForward - å°†æœ¬åœ°ç«¯å£æ˜ å°„åˆ°è¿œç«¯
  * -R è¡¨ç¤ºRemoteForward - å°†è¿œç¨‹ç«¯å£æ˜ å°„åˆ°æœ¬åœ°
* Githubé…ç½®proxyåŠ é€Ÿclone
  1. æœ¬åœ°çš„v2rayåœ¨10809çš„ç«¯å£ä¸Šå¼€å¯äº†httpæœåŠ¡
  2. é€šè¿‡ç«¯å£æ˜ å°„åœ¨ç™»å½•æœåŠ¡å™¨çš„æ—¶å€™æŒ‡å®š ssh -R 12450:localhost:10809 å»ºç«‹remoteçš„æ˜ å°„
     * ç«¯å£æ˜ å°„-Lä¼šå‡ºé—®é¢˜ï¼Œä¸æ˜ŽåŽŸå› 
  3. åœ¨gitçš„configä¸­è¿™æ ·å†™  ```[http] proxy=http://127.0.0.1:12450```
     * åœ¨ssh_configå½“ä¸­å¯ä»¥ ```RemoteForward 127.0.0.1:12450(port on remote) 127.0.0.1:10809```
* æ¸…åŽæ ¡å›­ç½‘å‡†å…¥æœåŠ¡å™¨ï¼š
  * ä»Žuserregè¿˜æ˜¯å¤ªéº»çƒ¦äº†
  * ä½¿ç”¨æ›´æ–°ä¹‹åŽçš„[auth-thu](https://github.com/z4yx/GoAuthing)ï¼Œç›´æŽ¥ä»Žreleaseä¸­ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åŽç›´æŽ¥è°ƒç”¨ ```./auth-linux_x86_64 auth```è¾“å…¥ç”¨æˆ·åå¯†ç å°±å¯ä»¥äº†
* æ³¨æ„SSH configä¸­çš„`LocalForward`å‰é¢çš„æ˜¯æœ¬åœ°çš„IPï¼Œå¯ä»¥ä¸ç”¨åŠ localhost



## è”ç½‘ç›¸å…³(ç™»å½•æœåŠ¡å™¨)

> è”ç½‘çœŸçš„æ˜¯ä¸€ä»¶å¾ˆè´¹åŠ²çš„äº‹æƒ…

* å¯èƒ½ä¼šå‡ºçŽ°ç™»å½•ä¸ä¸ŠæœåŠ¡å™¨çš„æƒ…å†µ
  * å¤§æ¦‚çŽ‡æ˜¯å› ä¸ºæ²¡æœ‰å‡†å…¥

### å‡†å…¥Tips

1. å¯¹äºŽä¸åœ¨ç½—å§†æ¥¼ç½‘æ®µçš„æœåŠ¡å™¨(eva8/9/10)ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»æœº(eva8.nics.cc)ä¸Šçš„32222ç«¯å£ä¼šrouteåˆ°è¿™å°evaæ‰€å¯¹åº”çš„è·³æ¿æœº(proxy.eva8.nics.cc),è¯¥è·³æ¿æœºä¼šåŒæ—¶åœ¨ç½—å§†æ¥¼ä¸Žå…¶ä»–æœåŠ¡å™¨æ‰€åœ¨ç½‘æ®µ(å¦‚ä¼Ÿæ¸…æ¥¼)ï¼Œåœ¨è·³æ¿æœºä¸Šå¯ä»¥ç™»å½•åˆ°å„ä¸ªcontainer

   * eva8ä¸»æœº(IP: eva8.nics.cc); eva8-proxy(IP: proxy.eva8.nics.cc); eva8çš„container(IP: foxfi.eva8.nics.cc) ä¸‰è€…IPéƒ½ä¸ä¸€æ ·ï¼Œä¸‰è€…å¦‚æžœå°†å…¶IPç›´æŽ¥é€šè¿‡useregå‡†å…¥ï¼Œå°±å¯ä»¥ç›´æŽ¥ç™»å½•

   * ç™»å½•ä¸åœ¨åŒä¸€ç½‘æ®µçš„æœºå™¨éœ€è¦åœ¨cfgé‡Œé¢å¤–æœ‰ä¸€ä¸ª   

     ```
     Host proxy-eva8:
     	HostName: eva8.nics.cc
     	Port: 32222
     	User: 
     	Proxy: xxx
     	
     Host proxy-eva8:
     	HostName: proxy.eva8.nics.cc
     	User: 
     	Proxy: xxx
     ```

     * è¿™ä¸ªcfgå®šä¹‰äº†eva8ä¸­çš„è·³æ¿æœºï¼Œå…¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªcontainerï¼Œå¼€åœ¨ä¸»æœºçš„32222ç«¯å£(ä¸»æœºé€šè¿‡ä¿®æ”¹è·¯ç”±NATè¡¨è‡ªåŠ¨å°†åŒ…éƒ½è½¬å‘åˆ°äº†proxy containeræ‰€åœ¨çš„IP) - æ‰€ä»¥å°†ä¸»æœºå‡†å…¥æˆ–è€…æ˜¯å°†proxyæ‰€åœ¨çš„containerå‡†å…¥ï¼Œéƒ½å¯ä»¥å°†å…¶è¿žå…¥æ¸…åŽå†…ç½‘ï¼›proxy containerå°†å„ä¸ªeva containerä¸Ževaä¸»æœºé€šè¿‡å†…ç½‘è¿žæŽ¥(ä¸ç”¨æ¯ä¸ªcontaineréƒ½å‡†å…¥ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™æ ·è·³è½¬)
     * å½“é‡å¯ä¹‹åŽï¼Œåªè¦å°†ä¸»æœºå…¥ç½‘ï¼Œå°±å¯ä»¥è®©æ‰€æœ‰çš„containeré€šè¿‡æ–¹å¼Aç™»å½•äº†ã€‚

2. è¿žå¤–ç½‘

   * ä¸€ç§æ˜¯useregç›´æŽ¥è¾“å…¥ip
   * ä¸€ç§æ˜¯å‡†å…¥```~/auth-thu.linux.x86_64 auth```

3. å¤šæœåŠ¡å™¨ä¹‹é—´æ‹·è´æ–‡ä»¶

   * æ³¨æ„ä¸€ä¸‹å¯èƒ½åœ¨cfgä¸­æœ‰å…³äºŽåŸŸåçš„alias
### SCP

* `zhaotianchen@foxfi-eva8:~$ scp ztc.eva7.nics.cc:/home/zhaotianchen/awnas/data/modelnet40_normal_resampled.zip ./`
* æŸæ¬¡å‡ºçŽ°äº†æ— è®ºæ€Žä¹ˆå‡†å…¥éƒ½æ— æ³•pingé€šçš„æƒ…å†µï¼Œå‘çŽ°æ˜¯eva7çš„æŸä¸ªcontainerçš„IP tableå‡ºäº†é—®é¢˜ï¼Œåˆ é™¤æŽ‰æŸæ¡ruleä¹‹åŽå¥½äº†
  * ä½¿ç”¨`route`å‘½ä»¤ï¼Œæ‰¾åˆ°ä¸€ä¸ªdefaultçš„è·¯ç”±ï¼Œgwæ˜¯10å¼€å¤´çš„ï¼Œæ‰‹åŠ¨åˆ é™¤
  * `sudo route del default gw 10.0.3.1`
* ![image-20210410105419818](C:\Users\A-suozhang\AppData\Roaming\Typora\typora-user-images\image-20210410105419818.png)

1. å„ä¸ªæœåŠ¡å™¨ä¸­é—´å¯èƒ½å­˜æ•°æ®é›†çš„åœ°æ–¹

   * åªæœ‰eva7æ˜¯`/data/eva_share_users`ï¼Œå…¶ä»–çš„åŸºæœ¬éƒ½æ˜¯`/home/eva_share_users`


### å¼€æœºè‡ªå¯åŠ¨

* [Linuxå¼€æœºè‡ªåŠ¨åŒ–æ‰§è¡Œè„šæœ¬çš„å››ç§æ–¹æ³•ï¼ˆçœŸå®žæ¡ˆä¾‹åˆ†äº«ï¼‰_æ¸…é£Žé˜-CSDNåšå®¢_linuxå¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬](https://blog.csdn.net/abc_12366/article/details/87552848)

## CUDA Stuff

* å¦‚æžœsmiä¸å‡ºæ¥ä¸œè¥¿äº†åŽ»/opt/cuda-x.xä¸­æ‰§è¡ŒdeviceQuery(å¯èƒ½éœ€è¦sudo)

* é€šè¿‡åœ¨bashä¸­ç”¨ LD_LIBRARY_PATHæ¥æŒ‡å®šç”¨ä»€ä¹ˆcuda

  * å¦‚æžœä¸ºç©ºçš„è¯å°±ä¼šæŸ¥è¯¢ PATH, é‡Œé¢ä¸€èˆ¬æœ‰ ```/usr/lib/cuda```, æŸ¥è¯¢ä¹‹åŽåº”è¯¥åœ¨evaæœåŠ¡å™¨ä¸­æ˜¯ä¸€ä¸ªè½¯è¿žæŽ¥è¿žæŽ¥åˆ°äº†/opt/cudaé‡Œ

  * $PATHå˜é‡æœ¬èº«é€šè¿‡"ï¼š"åˆ†éš”,åŽé¢çš„è¦†ç›–ï¼Œå¸¸ç”¨çš„æ–¹å¼ ```PATH=PATH:some_new_path```

    



## Install  a few stuff

* å¬ä»Ž[åˆä»£ç›®ç½‘ç®¡çš„æ„è§](https://nicsefc.ee.tsinghua.edu.cn/wiki/dl:install)ï¼Œå®‰è£…MiniConda3
  * æ–‡ç« ä¸­ï¼Œcondaå…¬å¸å’ŒIntelæœ‰pyï¼Œä»Žå®ƒè¿™é‡Œä¸‹çš„åŒ…CPUè®¡ç®—ä¼šæ›´å¿«è¯´æœäº†æˆ‘ï¼ˆ~~è™½ç„¶ä¸çŸ¥é“åˆ°åº•æœ‰å¤šçœŸå®ž~~ï¼‰
  * è€Œä¸”condaä¹Ÿå’Œpipå…¼å®¹ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢
  * ä¹‹å‰ä¸è£…condaæ˜¯å› ä¸ºå®ƒèµ·æ‰‹å°±å®‰äº†ä¸€ä¸‡ä¸ªåŒ…ï¼ŒåŽŸæ¥æ˜¯æˆ‘æ²¡æœ‰å‘çŽ°miniconda

```
wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh
chmod +x Miniconda3-latest-Linux-x86_64.sh
./Miniconda3-latest-Linux-x86_64.sh

// æ‰“å¼€ä¸€ä¸ªæ–°çš„Shell(é‡æ–°ç™»å½•ä¸€æ¬¡)

conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --set show_channel_urls yes
```

* å®‰è£…äº†shadowsocksä¸ŽProxychainsæ¥åŠ å¿«git cloneé€Ÿåº¦

* å®‰è£…opencv
  * ```conda install python-opencvå¤±è´¥```
    * ```pip3 install python-opencv```å®‰è£…ä¸ä¸Š
    * å®‰è£…äº†condaä¹‹åŽï¼Œå¯¹åº”çš„pythonæ˜¯pipå¯¹åº”çš„ï¼Œè€Œpip3å¯¹åº”çš„æ˜¯è€çš„python3
  * ä¸­é—´æŠ¥äº†  ```å®‰è£…opencvæ—¶æŠ¥é”™ ImportError: libXrender.so.1: cannot open shared object file: No such file or directory```
    * ç›´æŽ¥ ```sudo apt-get install libxrender1```

* å®‰è£…tmuxå¹¶é…ç½®
  * æŒ‰ç…§ç½‘ç®¡ç»™çš„tmux.confå¯åŠ¨
  * *ä¿®æ”¹ä¸€ä¸‹tmuxçš„å¿«æ·é”®prefix(CTRL+Bå®žåœ¨æ˜¯å¤ªè¿œäº†,æ”¹æˆ+xå§)*
    * æŸ¥çœ‹çŽ°åœ¨çš„Prefix Binidng```tmux show-options -g | grep prefix```
    * åœ¨~/.tmux.confä¸­åŠ ä¸Š
      ```
       set -g prefix C-x
       unbind C-b
       bind C-x send-prefix
      ```
    * ä½¿å…¶ç”Ÿæ•ˆ:
      * åœ¨tmuxä¸­ CTRL+B+(æ­¤æ—¶è¿˜æ²¡æœ‰æ”¹å¥½)): è¾“å…¥source-flie ~/.tmux.conf
      * è¿™ä¹‹åŽçš„éƒ½okäº†


* å¯¹vimçš„å®‰è£…å’Œé…ç½®è§[Ubuntuç³»ç»Ÿé…ç½®ï¼](http://a-suozhang.xyz/2020/01/08/UbuntuSetup/)

* Pytorchçš„å®‰è£…


  * æœ‰çš„æ—¶å€™ä¼šæ— æ³•è‡ªåŠ¨åŒ¹é…åˆ°æ‰€éœ€è¦çš„cudaç‰ˆæœ¬ï¼Œæˆ–è€…æ˜¯è‡ªåŠ¨å®‰è£…äº†æ›´æ–°ç‰ˆæœ¬çš„pytorchè€Œå¯¼è‡´æ— æ³•cuda()
  * ck CUDA ç‰ˆæœ¬`echo $PATH; echo $LD_LIBRARY_PATH`
  * å¼ºåˆ¶forceå®‰è£…æŸä¸ªç‰ˆæœ¬ `pip install torch==1.7.0`

    * ä½†æ˜¯å³ä½¿è¿™æ ·æœ‰æ—¶å€™tuna mirroræ‰¾ä¸åˆ°å½“å‰ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦`pip install torch==1.7.1+cu101 -f https://download.pytorch.org/whl/torch_stable.html`è¿™æ ·é‚£ç›´æŽ¥ä»Žpytorchå®˜æ–¹çš„stableæºæ¥ä¸‹è½½

* eva0ä¸Šnvccè²Œä¼¼æ²¡æœ‰ç»“æžœ(ä¸çŸ¥é“æ˜¯ä¸æ˜¯å’Œæœ‰å¥½å‡ ä¸ªcontainerç›¸å…³)
  * æŒ‰ç…§bingåˆ°çš„ç»“æžœåŽ»çœ‹ /usr/local/cudaä¸‹çš„version.txtè²Œä¼¼ä¹Ÿä¸æ˜¯å¾ˆè¡Œ
  * å’¨è¯¢äº†ç½‘ç®¡ä¹‹åŽçš„ç»“æžœ
    * åœ¨/opt/cuda-10.0ç›®å½•åº•ä¸‹æœ‰ç€cuda
    * *æµ‹è¯•cudaæ˜¯å¦èƒ½ç”¨*
      
      * è¿è¡Œ/opt/cuda-10.0/samples/1_Utilities/deviceQuery/ä¸‹çš„deviceQueryå¯æ‰§è¡Œæ–‡ä»¶
      * **å¼€æœºä¹‹åŽè¦é¦–å…ˆè¿è¡Œä¸€æ¬¡è¿™ä¸ªè„šæœ¬ï¼Œå¦åˆ™cudaå°±ç”¨ä¸äº†ï¼**
      * æ­£ç¡®çš„çŽ°è±¡
        
        * ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20191021215750.png)
      * åŒæ—¶ç»™å‡ºnvidia-smiç»“æžœ
        
        * ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20191021200015.png)
      * åœ¨pytorchå®˜ç½‘é€‰æ‹©å®‰è£…: Conda-Python3.7-cuda10.1
        
        * *å¤§æ¦‚800Mçš„ä¸‹è½½ä¹‹åŽå°±å®‰è£…å¥½äº†*
      * æµ‹è¯•cuda okæ²¡æœ‰
      
        ``` python
        import torch
        torch.cuda.is_available()
        ```


* ðŸ› Matplotlib.pyplot importçš„æ—¶å€™æŠ¥é”™äº† 
    ```
    This application failed to start because it could not find or load the Qt platform plugin "xcb"in "".
    Available platform plugins are: eglfs, minimal, minimalegl, offscreen, vnc, xcb.
    Reinstalling the application may fix this problem.
    ```
    * åŽŸå› æ˜¯ç¼ºå°‘äº†Qtçš„æ”¯æŒ
      * [åœ¨è¿™é‡Œæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ ]](https://github.com/OpenShot/openshot-qt/issues/1809)
      
      * ```sudo apt-get install libqt5gui5```
      
        
    
    ## 



## SSH é…ç½®ç›¸å…³-deprecated

> deprecated

* é‚£ä¹ˆå¦‚ä½•ç™»å½•evaå‘¢ï¼Ÿ
  * é…ç½®äº†LinuxçŽ¯å¢ƒä¸‹é€šè¿‡è·³æ¿æœºç›´æŽ¥è®¿é—®ç›®æ ‡æœºå™¨
    * ä¸€æ¬¡sshè€Œä¸æ˜¯ä¸¤æ¬¡
    * ä¸»è¦å‚è€ƒäº†[è¿™ç¯‡æ–‡ç« ](https://blog.csdn.net/DiamondXiao/article/details/52474104)
    * åœ¨.bashrcé‡Œé¢åŠ ä¸Š
    ``` bash
      alias eva="ssh zhaotianchen@101.6.64.144 -p 22 -o ProxyCommand='ssh -p 42222 zhaotianchen@101.6.64.67 -W %h:%p'"
      alias fpga="ssh ztc@fpga1.nics.cc -p 22 -o ProxyCommand='ssh -p 42222 zhaotianchen@101.6.64.67 -W %h:%p'"
    ```
  * æŒ‰ç…§ä¸Šé¢çš„é…ç½®ä¹‹åŽè¿˜éœ€è¦å†è¿›è¡Œä¸€æ¬¡ç§˜é’¥copy
    * ```ssh-copy-id  -i id_rsa.pub zhaotianchen@101.6.64.144 -p 22 -o ProxyCommand='ssh -p 42222 zhaotianchen@101.6.64.67 -W %h:%p'```
    * è¯´æ˜Žä»Žè·³æ¿æœºç™»å½•ï¼ˆ2æ¬¡ï¼‰éœ€è¦çš„ç§˜é’¥å’Œä¸€æ¬¡çš„éœ€è¦æ˜¯ä¸ä¸€æ ·çš„
    * fpga1.nics.cc -> 101.6.68.236(ç”±äºŽç”¨ssh configæ–‡ä»¶è¿™ç§æ–¹å¼ç™»å½•çš„è¯ä¸èƒ½ç”¨åŸŸå)

* æœåŠ¡å™¨çš„è·³æ¿æœºä¸€å®šè¦ä»Žä¸€å®šç«¯å£ç™»å½•ï¼Œä¸ç„¶å°±ç™»å½•Permission denied
	
* æ¯”å¦‚è¯´eva10.nics.ccå¿…é¡»è¦ä»Ž32222 portè®¿é—®
	
* å…³äºŽå…å¯†ç ç™»å½•
	* æœ¬æœºçš„.sshæ–‡ä»¶å¤¹é‡Œæœ‰ä¸€å¯¹å¯†é’¥ï¼Œid_rsa.pubå’Œid_rsa
	* å…¶ä¸­æ‰§è¡Œ```ssh-copy-id -i id_rsa.pub $SERVER_NAME```å®žé™…å®Œæˆçš„æ“ä½œå°±æ˜¯æŠŠid_rsa.pubé‡Œé¢çš„ä¸œè¥¿å¤åˆ¶åˆ°æœåŠ¡å™¨ä¸Šçš„.ssh/authorized_keysé‡Œé¢
		* ç”±äºŽwinå¹¶æ²¡æœ‰ssh-copy-id å‘½ä»¤ï¼Œå¯ä»¥ç›´æŽ¥ç™»å½•æœåŠ¡å™¨æ‰‹åŠ¨é…ç½®ï¼Œæˆ–è€…æ˜¯ç”¨scpæŠŠauthorized_keysç»™ä¼ ä¸ŠåŽ»(åœ¨winä¸‹vimä¸å¥½ä½¿çš„æƒ…å†µä¸‹)
		* æ³¨æ„scpæŒ‰ç…§portæ¥ä¼ è¾“çš„å‘½ä»¤æ˜¯```scp -P xxx```
	* å®Œæˆå¤åˆ¶ä¹‹åŽï¼Œä»Ž**æœ‰ç§é’¥çš„æœåŠ¡å™¨**ç™»å½•åˆ°æ–°çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æŽ¥å…å¯†ç ç™»å½•ï¼ˆä½†æ˜¯æ³¨æ„æ²¡æœ‰ç§é’¥çš„åœ°æ–¹è¿˜æ˜¯ä¸è¡Œï¼Œæ‰€ä»¥ä»Žä¸­é—´èŠ‚ç‚¹ç›´æŽ¥è¿žæœ€åŽæ˜¯ä¸è¡Œçš„ï¼‰
	* å…¶ä»–çš„æ¯”å¦‚known_hostsä»€ä¹ˆçš„å…¶å®žä¸ç”¨æ”¹ä¹Ÿå¯ä»¥

* ~~Tensorboardè¿œç¨‹æ˜ å°„~~ï¼ˆDeprecatedï¼‰ Use ```ssh -L 10808:localhost:127.0.0.1 ztc.eva10``` 
  * [é€šè¿‡è·³æ¿æœºæŸ¥çœ‹å†…ç½‘æœåŠ¡å™¨çš„tensorbord](https://blog.csdn.net/Woody0729/article/details/80933014)
  * é…ç½®æ–°çš„ç™»å½•Evaçš„æ–¹å¼(ä»¥æ”¯æŒç«¯å£ä¼ æ’­,ä»Žè€Œçœ‹åˆ°Tensorboard)
    * éœ€è¦ç™»å½•ä¸¤æ¬¡,é¦–å…ˆç™»å½•è·³æ¿æœº with
      * ```ssh -L 16006:127.0.0.1:8008 account@è·³æ¿æœºip```
    * ç„¶åŽåœ¨è·³æ¿æœºä¸Šç™»å½•with 
      * ```ssh -L 8008:127.0.0.1:6006 account@æœåŠ¡å™¨ip```
    * æœ€åŽç›´æŽ¥åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„localhost:16006è§‚å¯Ÿç»“æžœ
    * *æ³¨æ„è¿™è¾¹å¯èƒ½åˆ·æ–°å’ŒLoadä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿ,ç¨å¾®ç­‰ä¸€ä¼šTensorboardçš„å†…å®¹ä¼šé€æ¸loadå‡ºæ¥*

* å¦‚æžœX11 Forwardingå‡ºäº†é—®é¢˜,æ‰“ä¸å¼€matplotlib,å¯ä»¥å…ˆ

```
import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt
```


---

* [blog-1](https://deepzz.com/post/how-to-setup-ssh-config.html)
* [blog-2](https://mdgsf.github.io/2019/08/01/linux-ssh-study/)


---

# Ray Setup
1. å®‰è£…ray
2. æŒ‰ç…§scripts/python rayå¤‡æ³¨ä¸­çš„æ ¼å¼è®¾ç½®ray(æ¯ä¸ªæœºå™¨æˆ–è€…conda envåªéœ€è¦è®¾ç½®ä¸€æ¬¡)
	* éœ€è¦è®°å½•ä¸‹ä¸€ä¸ªredis-dir
	* ![](https://github.com/A-suozhang/MyPicBed/raw/master/img/20200104165140.png)
3. æ–°å»ºä¸€ä¸ªexperimentæ–‡ä»¶å¤¹,å†…éƒ¨è¯´æ˜Žæ–¹æ³•çš„åå­—
4. å†™ä¸€ä¸ªè„šæœ¬ç”Ÿæˆæ–°çš„yamlæ–‡ä»¶,æ”¾ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹
5. è°ƒç”¨è„šæœ¬ python train_ray.py --redisdir=XXX $PATH_TO_YAML_DIR
	* åˆ™ä¼šè‡ªåŠ¨loadä¸‹dirç›®å½•ä¸‹çš„æ¯ä¸ªyamlæ–‡ä»¶
	* æ¯å½“ä¸€ä¸ªå®žéªŒå®Œæˆä¹‹åŽä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªè¿›ç¨‹å°†æ–°çš„å®žéªŒæ·»åŠ è¿›åŽ»
	* æœ‰ä¸¤ä¸ªå¿…é¡»çš„arg
		* redis-addr å¯åŠ¨rayæ—¶å€™ä¼šç»™çš„åœ°å€
		* result-base-dir å­˜æ”¾logçš„åœ°å€
			* ä¼šè‡ªåŠ¨appendä¸Šè¿™æ¬¡è°ƒæ•´çš„å‚æ•°çš„åå­—(ä¹Ÿå°±æ˜¯experimentçš„yaml settingæ‰€åœ¨çš„dirå‰é¢ä¸€å±‚)
		* å†åŽé¢å°±æ˜¯æ­£å¸¸mainå‡½æ•°çš„yamlæ‰€åœ¨çš„æ–‡ä»¶å¤¹,ä¼šè¯»å–è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰yamlå¹¶ä¸”è·‘

* è®°ä¸ä½redis-addræ€Žä¹ˆåŠž,å› ä¸ºæ¯ä¸€æ¬¡start rayçš„æ—¶å€™ä¼šéšæœºäº§ç”Ÿä¸€ä¸ª,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ª,åœ¨rayçš„å‘½ä»¤é‡Œ
	* ```alias ray-start="CUDA_VISIBLE_DEVICES=0,1,2,3 ray start --head --num-cpus 10 --num-gpus 4 --object-store-memory 10000000 --redis-port=12450```

---

# Conda Virtual Env

* ```conda create -n $NAME python=3.7```
	* æœ€å¥½ç›´æŽ¥åœ¨æœ€åŽç”¨python=3.7ï¼Œè¿™æ ·ä¼šç›´æŽ¥åœ¨å½“å‰çŽ¯å¢ƒä¸‹ç”Ÿæˆä¸€ä¸ªçŽ¯å¢ƒ```miniconda3/envs/$NAME/bin/python```ï¼Œæ›´åŠ ä¸å®¹æ˜“å’Œglobalçš„pythonæžèµ·æ¥
	* ç„¶åŽpipåº”è¯¥ä¹Ÿæ˜¯å®‰è£…åˆ°äº†å¯¹åº”ä½ç½®ä¸ç”¨ä¿®æ”¹ï¼Œç„¶åŽç”¨```pip install ipython```
	* å®‰è£…å®Œæˆä¹‹åŽè™½ç„¶```which ipython```æ­£ç¡®ï¼Œå†…å®¹ä¹Ÿæ­£ç¡®ï¼Œä½†æ˜¯è¾“å…¥ipythonè¿˜æ˜¯globalçš„ - éœ€è¦**decativateå†é‡æ–°ç™»å½•è™šæ‹ŸçŽ¯å¢ƒä»¥reloadçŽ¯å¢ƒ**
* ```conda deactivate``` é€€å‡ºçŽ°æœ‰çŽ¯å¢ƒ
* ```conda info -e``` æŸ¥çœ‹çŽ°æœ‰çš„çŽ¯å¢ƒ
* ```conda remove -n $NAME --all```
* ```conda create -n $NEW --clone $OLD; conda remove -n $OLD --all```

* æœ‰çš„æ—¶å€™æ›´æ–°äº†çŽ¯å¢ƒä¹‹åŽè¿˜pipè¿˜æ˜¯æŒ‡å‘äº†baseé‡Œé¢çš„pip
	* è¿™ä¸ªæ—¶å€™decativateä¸€ä¸‹ç„¶åŽå†activateå°±å¯äº†
	* æ³¨æ„ä¸€å®šè¦deactivateå†activateï¼Œå…³æŽ‰panelå†activateå¥½åƒæ˜¯æ²¡ç”¨çš„(è²Œä¼¼ä¸æ˜¯ä¸€ç›´work)
		* çŽ°åœ¨å±…ç„¶æ˜¯å…ˆè¾“å…¥ä¸€ä¸ªé”™çš„conda envåå­—ç„¶åŽå†è¾“å…¥å°±å¥½äº†â€¦â€¦(äººç±»è¿·æƒ‘)

* æœ‰çš„æ—¶å€™ä¼šå‡ºçŽ°æ— è®ºæ“ä½œä»€ä¹ˆéƒ½segmentation faultçš„æƒ…å†µ(ç”šè‡³é‡è£…condaä»¥åŠæ›´æ–°conda)
  * è¿™ä¸ªæ˜¯å¶ç”¨```conda clean -a```æ¥æ¸…æ¥šæœ¬åœ°çš„ç¼“å­˜(å¯èƒ½æ˜¯å› ä¸ºä¸­é€”ç½‘ç»œé”™è¯¯å¯¼è‡´çŠ¶æ€å´©é¢“)
  * [å±…ç„¶æ˜¯ä¸€ä¸ªCSDNçš„blogæ•‘äº†æˆ‘](https://blog.csdn.net/u012110870/article/details/103800701)


* å¦‚æžœéœ€è¦renameä¸€ä¸ªenvçš„è¯
	* éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çŽ¯å¢ƒ ```conda create --name NEW_NAME --clone OLD_NAME```
	* ç„¶åŽåˆ é™¤è€çš„çŽ¯å¢ƒ ```conda remove --name OLD_NAME --all```

* deäº†ä¸€ä¸ªipythonçŽ¯å¢ƒçš„bugï¼Œä¸€å¼€å§‹çš„é”™è¯¯æç¤ºæ˜¯åœ¨çŽ¯å¢ƒä¸­ä»ç„¶ä½¿ç”¨äº†baseçŽ¯å¢ƒçš„ipython
  * ç”±äºŽ$PATHå†…éƒ¨.local/binåœ¨conda/env/xxxçš„å‰é¢ã€‚æ‰€ä»¥ä¼˜å…ˆè°ƒç”¨äº†baseçŽ¯å¢ƒä¸‹çš„ipython
  * æ£€æŸ¥bashrcçš„æ—¶å€™å‘çŽ°å¹¶æ²¡æœ‰.local/binè¿™ä¸ªä¸œè¥¿ï¼Œç„¶åŽå‘çŽ°æ˜¯åœ¨~/.profileå½“ä¸­æ”¹åŠ¨äº†$PATHï¼Œå°†.local/binæ”¾åˆ°PATHçš„æœ€åŽ
  * **åŸºæœ¬condaçŽ¯å¢ƒä¸­å¯¹ä¸ä¸Šçš„æƒ…å†µï¼ŒåŒ…æ‹¬pipå’Œpythonï¼Œéƒ½æ˜¯$PATHçš„é—®é¢˜ï¼Œå…¶è¿è¡Œå‡†åˆ™æ˜¯ä¼˜å…ˆåŒ¹é…å‰é¢çš„**

## æºç ç¼–è¯‘TF

> following [official guide](https://www.tensorflow.org/install/source)

1. å®‰è£…prequisite

``` py
pip install -U --user pip six numpy wheel setuptools mock 'future>=0.17.1'
pip install -U --user keras_applications --no-deps
pip install -U --user keras_preprocessing --no-deps
```

2. å®‰è£…[bazel](https://docs.bazel.build/versions/master/install-ubuntu.html)
  * **æ³¨æ„éœ€è¦æŸ¥çœ‹ä¸€ä¸‹bazelçš„ç‰ˆæœ¬ï¼Œåœ¨tensorflowæºç çš„configure.pyä¸­æœ‰ç€å¯¹åº”ç‰ˆæœ¬æ‰€èƒ½æŽ¥å—çš„bazelç‰ˆæœ¬**
  * å»ºè®®ç›´æŽ¥ä»Žå®˜ç½‘ï¼Œä»¥åŠ[å®˜æ–¹git repo](https://github.com/bazelbuild/bazel/releases)ä¸‹è½½binaryå®‰è£…åŒ…å®‰è£…
  * ```chmod +X ./bazel-xxx```
  * ```./bazel-xxx --user```
    * æ³¨æ„è¿™é‡Œçš„--userå¾ˆå…³é”®ï¼Œä¼šåŠ å…¥çŽ¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯å°†å½“å‰ç‰ˆæœ¬çš„bazelå®‰è£…åˆ°```~/bin/bazel```
  * éœ€è¦åœ¨bashrcä¸­åŠ ä¸€è¡Œ
    * ```export PATH="$PATH:$HOME/bin"```
  * è¿˜æœ‰ä¸€ç§æ›¿ä»£æ–¹æ¡ˆï¼Œç›¸å½“äºŽæ˜¯bazelçš„ç¼–è¯‘å®Œçš„ç‰ˆæœ¬[bazelisk](https://github.com/bazelbuild/bazelisk)ä¸ªäººæ²¡æœ‰å°è¯•
    * å…¶ä½¿ç”¨åº”è¯¥æ˜¯æ›¿æ¢bazelçš„ï¼Œå¯ä»¥ç›´æŽ¥åœ¨bashrcä¸­```alias bazel=$PATH_TO_BAZELISK```

3. ä¸‹è½½tfæºç 
  * (å…¶å®žå¯èƒ½åº”è¯¥æ”¾åœ¨å®‰è£…bazelä¹‹å‰)
  * ```git clone https://github.com/tensorflow/tensorflow.git```
  * åˆ‡æ¢åˆ°æƒ³è¦çš„åˆ†æ”¯ï¼Œé»˜è®¤ä¸ºæœ€æ–°çš„masteråˆ†åª```git checkout branch_name  # r1.9, r1.10```

4. é…ç½®Build
  * ```./configure``` - åˆ«çš„éƒ½æ— æ‰€è°“å¯ä»¥é»˜è®¤ï¼Œå°±æ˜¯è¦æŒ‡å®šä¸€ä¸‹CUDAçš„ä½ç½®```/opt/cuda-10.0```
  * ç»è¿‡configureä¹‹åŽçš„å†…å®¹æ˜¯åœ¨
  * æœ‰å‡ ä¸ªé¢„è®¾çš„bazel buildæŒ‡ä»¤
    * ```--config=mkl```
    * ```--config=v1``` 

5. ç¼–è¯‘(æœ€å¯èƒ½å‡ºé”™çš„ä¸€èŠ‚)
* ç»è¿‡æˆ‘è‡ªå·±çš„ä½“éªŒï¼Œè²Œä¼¼checkoutåˆ°è€ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘å®¹æ˜“å‡ºé—®é¢˜(æ€»ä¹‹æˆ‘æ˜¯å¤±è´¥äº†)
* é»˜è®¤çš„TF-2.0ç¼–è¯‘ ```bazel build //tensorflow/tools/pip_package:build_pip_package```
  * å¯¹masteråˆ†æ”¯ç¼–è¯‘1.xç‰ˆæœ¬ ```bazel build --config=v1 //tensorflow/tools/pip_package:build_pip_package```
  * CUDAç‰ˆæœ¬ ```bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package```
    * ä¸Šæ¬¡è·‘è¿™ä¸ªæ˜¯å¤±è´¥äº†
* æ³¨æ„å¦‚æžœéœ€è¦åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ç¼–è¯‘å¤šæ¬¡tfï¼Œéœ€è¦æ‰§è¡Œ```bazel clean```
* è¯¥æ­¥éª¤ç”Ÿæˆäº†ä¸€ä¸ª```build_pip_package```çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥ä½¿ç”¨

6. ç”Ÿæˆwhl
* è¿™ä¸€æ­¥è²Œä¼¼ä¸å®¹æ˜“å‡ºé—®é¢˜
* ```./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg```
  * å®˜æ–¹è¯´å¦‚æžœæ˜¯æœ€æ–°çš„éœ€è¦åŠ ä¸Šä¸€ä¸ªnightly flagï¼Œ```./bazel-bin/tensorflow/tools/pip_package/build_pip_package --nightly_flag /tmp/tensorflow_pkg```
* ````pip install /tmp/tensorflow_pkg/tensorflow-version-tags.whl```


### å®‰è£…nccl

> ä¸ç¡®å®šå¯èƒ½ç¼–è¯‘å‡ºæ¥çš„tféœ€è¦å®‰è£…è¿™ä¸ªä¸œè¥¿

* [Nvidiaå®˜ç½‘è¿›è¡Œä¸‹è½½](https://developer.nvidia.com/nccl/nccl-download)
  * ä¸‹è½½å¯¹åº”çš„cudaç‰ˆæœ¬ï¼Œéœ€è¦çš„å¹³å°(x86)ï¼Œéœ€è¦çš„å‘è¡Œç‰ˆ(ubuntu 18.04)
  * (å½“å‰NCCLå¥½åƒè¦æ±‚cuda>10.0/cuda-driver>ä¸€å®šç‰ˆæœ¬)
* ```sudo dkpg -i nccl-xxx.deb```å®‰è£…
* æ·»åŠ key ```sudo apt-key add /var/nccl-repo-2.6.4-ga-cuda10.0/7fa2af80.pub```
  * ç”šè‡³æˆ‘æ·»åŠ keyè¿˜å°‘äº†ä¸€ä¸ªåº“ ```sudo apt-get install gnupg```
* ```sudo apt-get update```
* ```sudo apt install libnccl2 libnccl-dev```
* å®‰è£…çš„nccl.håœ¨```/usr/include/nccl.h```

* ç”±äºŽæˆ‘çš„cudaå¹¶ä¸åœ¨æ ‡å‡†ä½ç½®```/usr/lib```ï¼Œæ‰€ä»¥éœ€è¦åœ¨cudaçš„å¯¹åº”æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸¤ä¸ªè½¯è¿žæŽ¥ï¼Œæ‰èƒ½è®©tfçš„configureèƒ½å¤Ÿdetectåˆ°
  * ```/usr/lib/nccl.h``` -> ```$CUDA_PATH/include```
  * ```/usr/lib/x86_64-linux-gnu/libnccl.so.2``` -> ```$CUDA_PATH/LIB64```
### å®‰è£…android studio

* [Tutorial](https://github.com/tensorflow/examples/tree/master/lite/examples/object_detection/android)
* [å®˜ç½‘å®‰è£…]()

